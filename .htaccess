# Enable Apache rewrite engine
RewriteEngine On

# Set the base path (adjust if your site is in a subdirectory)
RewriteBase /

# Handle client-side routing for React/Vite applications
# This ensures that all routes are served by index.html for client-side routing
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule ^(.*)$ index.html [QSA,L]

# Ensure that API calls or other special routes are handled properly
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|webp|svg|woff|woff2|ttf|eot|json|xml|webm|mp4|mov|avi|wmv|flv|ogv|mpg|mpeg|avi)$ [NC]
RewriteRule ^(.*)$ - [L]

# More specific SPA routing for nested routes
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/assets/
RewriteCond %{REQUEST_URI} !^/favicon\.webp$
RewriteCond %{REQUEST_URI} !^/manifest\.json$
RewriteCond %{REQUEST_URI} !^/robots\.txt$
RewriteCond %{REQUEST_URI} !^/sitemap\.xml$
RewriteCond %{REQUEST_URI} !^/static/
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^(.*)$ index.html [QSA,L]

# Add headers for video streaming optimization
<IfModule mod_headers.c>
    <FilesMatch "\.(webm|mp4|ogv|mov|avi|wmv)$">
        Header set Accept-Ranges "bytes"
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
</IfModule>

# Cache headers for static assets
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType text/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/vnd.microsoft.icon "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
    ExpiresByType application/x-font-ttf "access plus 1 year"
    ExpiresByType application/x-font-opentype "access plus 1 year"
    ExpiresByType application/font-otf "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresByType video/webm "access plus 1 year"
    ExpiresByType video/mp4 "access plus 1 year"
    ExpiresByType video/ogg "access plus 1 year"
    ExpiresByType video/mpeg "access plus 1 year"
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/pdf "access plus 1 hour"
</IfModule>
